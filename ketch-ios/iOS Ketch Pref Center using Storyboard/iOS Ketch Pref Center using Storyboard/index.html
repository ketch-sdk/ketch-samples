<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script>
            // Get query parameters
            let params = (new URL(document.location)).searchParams;
            let visitorIdValue = params.get("visitorId");
            
            // Add identities to dataLayer
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({visitorId: visitorIdValue});
            
            // Add multiple identities
            //params.foreach((value, key) => {
            //    window.dataLayer.push({key: value});
            //}
        </script>
        
        <!-- Insert Ketch Smart Tag here -->
        <script>!function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://global.ketchcdn.com/web/v1/config/org_code/property_code/boot.js",e.defer=e.async=!0,document.getElementsByTagName("head")[0].appendChild(e),window.semaphore=window.semaphore||[]}();</script>
        
        <script>
            // Show the preference center experience
            window.semaphore.push(['showPreferences'])
            
            // Custom plugin to listen for the closing of the preference center experience
            var custom_plugin = {
                'init': function(host) {
                    window.webkit.messageHandlers.iosListener.postMessage('custom plugin initialized');
                },
                'experienceHidden': function(host, config, reason) {
                    if ((reason.constructor.name === 'String' && reason === 'setConsent') || reason.constructor.name === 'MouseEvent') {
                        window.webkit.messageHandlers.iosListener.postMessage('PreferenceCenterClosed');
                    }
                }
            }
            
            // Register the custom plugin with the Ketch Smart Tag
            window.semaphore = window.semaphore || [];
            window.semaphore.push(['registerPlugin', custom_plugin]);
        </script>
    </head>
    <body>
    </body>
</html>

