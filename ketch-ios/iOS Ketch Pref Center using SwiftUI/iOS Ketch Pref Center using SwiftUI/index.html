<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script>
            let params = (new URL(document.location)).searchParams;
            let propertyName = params.get("propertyName") || "web";
            let orgCode = params.get("orgCode");
            let advertisingId = params.get("ios_advertising_id");
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({ios_advertising_id: advertisingId});

            var e=document.createElement("script");
            e.type="text/javascript";
            e.src=`https://global.ketchcdn.com/web/v2/config/${orgCode}/${propertyName}/boot.js`;
            e.defer=e.async=!0;
            document.getElementsByTagName("head")[0].appendChild(e);
            window.semaphore=window.semaphore||[];
        </script>
        
        <script>
            window.semaphore.push(['showPreferences'])
            
            var custom_plugin = {
                'init': function(host) {
                    window.webkit.messageHandlers.iosListener.postMessage({event : 'init'});
                },
                'experienceHidden': function(host, config, reason) {
                    if (reason.constructor.name === 'String' && reason === 'setConsent') {
                        window.webkit.messageHandlers.iosListener.postMessage({event : 'PreferenceCenterSubmit'});
                    } else if (reason.constructor.name === 'MouseEvent') {
                        window.webkit.messageHandlers.iosListener.postMessage({event : 'PreferenceCenterExit'});
                    }
                },
                'consentChanged': function(host, config, consent) {
                    window.webkit.messageHandlers.iosListener.postMessage({event : 'consentChanged', consent: consent});
                },
                'identitiesLoaded': function(host, config, content) {
                    window.webkit.messageHandlers.iosListener.postMessage({event : 'identitiesLoaded', content: content});
                }
            }
            
            window.semaphore = window.semaphore || [];
            window.semaphore.push(['registerPlugin', custom_plugin]);
        </script>
    </head>
    <body>
    </body>
</html>

